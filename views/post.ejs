<%include partials/header.ejs%>

<script>
  function confirmPostDeletion(){
    return confirm("Are you sure you want to delete this post?");
  }

  function confirmCommentDeletion(){
    return confirm ("Are you sure you want to delete this comment?");
  }
</script>

<h1> 
  <a href="/category/<%=category%>">
    <%=categoryName%> 
  </a> 
</h1>

<p><%=post.text%></p>
<p>Posted by user <%=post.username%></p>
<p><%=post.creationDate%></p>
<%if (post.creationDate !== post.editDate){%>
  <p>last edited <%=post.editDate%></p>
<%}%>

<%if (username === post.username){%>
  <form action="/category/<%=category%>/<%=post.id%>" method="POST"
   onsubmit="return confirmPostDeletion()">
    <input type="hidden" name="_method" value="DELETE"/>
    <input type="submit" value="Delete post"/>
  </form>
<%}%>

<hr>
<form action="/category/<%=category%>/<%=post.id%>" method="POST">
  <input type="textarea" name="text"/>
  <input type="submit" value="Comment"/>
</form>

<hr>
<ul>
  <%comments.forEach(function(comment){%>
    <li>
       <p><%=comment.text%></p>
       <%=comment.username%> on <%=comment.creationDate%> by 
       <%=comment.username%>

       <%if (username === comment.username){%>
         <form action="/category/<%=category%>/<%=post.id%>/comment/<%=comment.id%>" 
          method="POST" onsubmit="return confirmCommentDeletion();">
           <input type="hidden" name="_method" value="DELETE"/>
           <input type="submit" value="Delete comment"/>
         </form> 
       <%}%>

    </li>
  <%});%>
</ul>


<%include partials/footer.ejs%>
